async function main(){const t={root:document.documentElement,title:document.getElementById("overlay__title"),text:document.getElementById("overlay__text"),loadedText:"Success!",unloadedText:"Pick a location to get started",fetchingText:"Fetching, please wait...",errorText:errorText="Oops! Looks like there was an error fetching the data",state:"unloaded",set(t,e){switch(this.state=t,t){case"fetching":this.title.textContent=this.fetchingText,this.text.textContent="",this.root.style.setProperty("--state__fetching--opacity",.5),this.root.style.setProperty("--state__calculator--opacity",.5),this.root.style.setProperty("--state__overlay--opacity",1);break;case"loaded":this.title.textContent=this.loadedText,this.text.textContent="",this.root.style.setProperty("--state__fetching--opacity",1),this.root.style.setProperty("--state__calculator--opacity",1),this.root.style.setProperty("--state__overlay--opacity",0);break;case"error":this.title.textContent=this.errorText,this.text.textContent=e,this.root.style.setProperty("--state__fetching--opacity",1),this.root.style.setProperty("--state__calculator--opacity",.5),this.root.style.setProperty("--state__overlay--opacity",1)}}},e={deficit:document.getElementById("chart__deficit"),empty:document.getElementById("chart__empty"),surplus:document.getElementById("chart__surplus"),full:document.getElementById("chart__full")},o={button:document.getElementById("data-picker__button"),latitude:document.getElementById("data-picker__latitude"),longitude:document.getElementById("data-picker__longitude"),angle:document.getElementById("data-picker__angle")},a={numOfYears:{value:11},indoorT:{value:22},solar:{min:10,max:50,value:30,step:1},efficiency:{min:10,max:100,value:60,step:1},htc:{min:10,max:300,value:250,step:5},storage:{min:10,max:1e3,value:200,step:10}};for(const e of document.getElementsByClassName("controls__input"))e.min=a[e.id].min,e.max=a[e.id].max,e.step=a[e.id].step,e.value=a[e.id].default,document.getElementById("controls__"+e.id).textContent=a[e.id].value,e.addEventListener("input",(o=>{document.getElementById("controls__"+e.id).textContent=o.target.value,a[e.id].value=o.target.value,"loaded"===t.state&&d()}));const n=document.getElementById("chart__canvas-container"),s=document.getElementById("canvas"),r=s.getContext("2d"),l=window.devicePixelRatio;s.style.height=n.offsetHeight+"px",s.style.width=n.offsetWidth+"px",s.width=Math.floor(n.offsetWidth*l),s.height=Math.floor(n.offsetHeight*l),r.scale(l,l);const i=n.offsetHeight-2,u=(n.offsetWidth-2)/365;let c={};function d(){r.clearRect(0,0,s.width,s.height),r.fillStyle="#4CE0D2";const t=[],o=1e3*a.storage.value;t.push(o);const n=i/a.storage.value;let l=0,d=0,h=0,m=0;for(let e=0;e<c.Energy.length;e++){const s=a.solar.value*c.Energy[e]*(a.efficiency.value/100)+Math.min(a.htc.value*(c.Temperature[e]-a.indoorT.value)*24,0)+t[e];s>o?(t.push(o),m++,h+=s-o):s<0?(t.push(0),d++,l+=s):t.push(s);const y=e%365*u,p=i-t[e+1]/1e3*n;r.fillRect(y,p,2,2)}e.surplus.textContent=Math.round(h/a.numOfYears.value/1e3),e.deficit.textContent=Math.round(l/a.numOfYears.value/-1e3),e.full.textContent=Math.round(m/a.numOfYears.value),e.empty.textContent=Math.round(d/a.numOfYears.value)}o.button.addEventListener("click",(async()=>{t.set("fetching");const e=`https://off-grid.dlfdk.workers.dev/api/seriescalc?lat=${o.latitude.value}&lon=${o.longitude.value}&browser=1&outputformat=json&usehorizon=1&angle=${o.angle.value}&startyear=2005&endyear=2015`,a=await fetch(e).then((t=>t.json()));a.message?t.set("error",a.message):(c=function(t){const{inputs:{meteo_data:{radiation_db:e}},outputs:{hourly:o}}=t,a=Math.round(o.length/24),n={Energy:[],Temperature:[]};for(let t=0;t<a;t++){let e=0,a=0;for(let n=24*t;n<24*(t+1);n++)e+=o[n]["G(i)"],a+=o[n].T2m;n.Energy.push(Math.round(e)),n.Temperature.push(a/24)}return n}(a),d(),t.set("loaded"))}))}main();