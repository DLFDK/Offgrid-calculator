async function main(){const t={root:document.documentElement,title:document.getElementById("overlay__title"),text:document.getElementById("overlay__text"),loadedText:"Success!",unloadedText:"Pick a location to get started",fetchingText:"Fetching, please wait...",errorText:"Oops! Looks like there was an error fetching the data",state:"unloaded",set(t,e){switch(this.state=t,t){case"fetching":this.title.textContent=this.fetchingText,this.text.textContent="",this.root.style.setProperty("--state__fetching--opacity",.5),this.root.style.setProperty("--state__calculator--opacity",.5),this.root.style.setProperty("--state__overlay--opacity",1);break;case"loaded":this.title.textContent=this.loadedText,this.text.textContent="",this.root.style.setProperty("--state__fetching--opacity",1),this.root.style.setProperty("--state__calculator--opacity",1),this.root.style.setProperty("--state__overlay--opacity",0);break;case"error":this.title.textContent=this.errorText,this.text.textContent=e,this.root.style.setProperty("--state__fetching--opacity",1),this.root.style.setProperty("--state__calculator--opacity",.5),this.root.style.setProperty("--state__overlay--opacity",1)}}},e={deficit:document.getElementById("chart__deficit"),empty:document.getElementById("chart__empty"),surplus:document.getElementById("chart__surplus"),full:document.getElementById("chart__full")},o={button:document.getElementById("data-picker__button"),latitude:document.getElementById("data-picker__latitude"),longitude:document.getElementById("data-picker__longitude"),angle:document.getElementById("data-picker__angle"),location:document.getElementById("data-picker__location")},a={element:document.getElementById("map"),kortjs:document.getElementById("kortjs"),label:document.getElementById("data-picker__button-text"),state:"hidden",toggle(){"hidden"===this.state?this.show():this.hide()},show(){"shown"!==this.state&&(this.label.textContent="Close Map",this.state="shown",this.element.style.display="block",this.element.animate({opacity:0,offset:0},{duration:300}))},hide(){if("hidden"===this.state)return;this.label.textContent="Open Map",this.state="hidden";this.element.animate({opacity:0,offset:1},{duration:300}).addEventListener("finish",(()=>{this.element.style.display="none"}))}},n={numOfYears:{value:11},indoorT:{value:22},solar:{min:10,max:50,value:30,step:1},efficiency:{min:10,max:100,value:60,step:1},htc:{min:10,max:300,value:250,step:5},storage:{min:10,max:1e3,value:200,step:10}};for(const e of document.getElementsByClassName("controls__input"))e.min=n[e.id].min,e.max=n[e.id].max,e.step=n[e.id].step,e.value=n[e.id].value,document.getElementById("controls__"+e.id).textContent=n[e.id].value,e.addEventListener("input",(o=>{document.getElementById("controls__"+e.id).textContent=o.target.value,n[e.id].value=o.target.value,"loaded"===t.state&&h()}));const s=document.getElementById("chart__canvas-container"),i=document.getElementById("canvas"),l=i.getContext("2d"),r=window.devicePixelRatio;i.style.height=s.offsetHeight+"px",i.style.width=s.offsetWidth+"px",i.width=Math.floor(s.offsetWidth*r),i.height=Math.floor(s.offsetHeight*r),l.scale(r,r);const d=s.offsetHeight-2,c=(s.offsetWidth-2)/365;t.set("fetching");let u=await fetch("js/data.json").then((t=>t.json()));function h(){l.clearRect(0,0,i.width,i.height),l.fillStyle="#4CE0D2";const t=[],o=1e3*n.storage.value;t.push(o);const a=d/n.storage.value;let s=0,r=0,h=0,m=0;for(let e=0;e<u.Energy.length;e++){const i=n.solar.value*u.Energy[e]*(n.efficiency.value/100)+Math.min(n.htc.value*(u.Temperature[e]-n.indoorT.value)*24,0)+t[e];i>o?(t.push(o),m++,h+=i-o):i<0?(t.push(0),r++,s+=i):t.push(i);const y=e%365*c,g=d-t[e+1]/1e3*a;l.fillRect(y,g,2,2)}e.surplus.textContent=Math.round(h/n.numOfYears.value/1e3),e.deficit.textContent=Math.round(s/n.numOfYears.value/-1e3),e.full.textContent=Math.round(m/n.numOfYears.value),e.empty.textContent=Math.round(r/n.numOfYears.value)}h(),t.set("loaded"),o.location.addEventListener("click",(async()=>{a.toggle()})),o.button.addEventListener("click",(async()=>{const e=a.kortjs.dataset.getLongitude,n=a.kortjs.dataset.getLatitude,s=o.angle.value;a.hide(),t.set("fetching");const i=`https://off-grid.dlfdk.workers.dev/api/seriescalc?lat=${n}&lon=${e}&browser=1&outputformat=json&usehorizon=1&angle=${s}&startyear=2005&endyear=2015`,l=await fetch(i).then((t=>t.json()));l.message?t.set("error",l.message):(u=function(t){const{inputs:{meteo_data:{radiation_db:e}},outputs:{hourly:o}}=t,a=Math.round(o.length/24),n={Energy:[],Temperature:[]};for(let t=0;t<a;t++){let e=0,a=0;for(let n=24*t;n<24*(t+1);n++)e+=o[n]["G(i)"],a+=o[n].T2m;n.Energy.push(Math.round(e)),n.Temperature.push(a/24)}return n}(l),h(),t.set("loaded"))}))}main();